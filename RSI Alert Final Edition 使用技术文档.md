# RSI Alert Final Edition 使用技术文档

## 📋 目录

- [功能简介](#功能简介)
- [主要参数说明](#主要参数说明)
- [功能与界面说明](#功能与界面说明)
- [典型用法建议](#典型用法建议)
- [关键代码片段说明](#关键代码片段说明)
- [注意事项](#注意事项)
- [MetaTrader 5 兼容性说明](#metatrader-5-兼容性说明)
- [技术原理与信号判据](#技术原理与信号判据)
- [UI美化与交互细节](#ui美化与交互细节)
- [代码二次开发与定制扩展建议](#代码二次开发与定制扩展建议)
- [策略适用性与风险提示](#策略适用性与风险提示)
- [常见问题与调试建议](#常见问题与调试建议)

---

## 🚀 功能简介

本EA支持多周期 RSI 反转、顶底背离自动监控。

### 核心特性

- ✅ 手动切换中文/英文界面
- ✅ 集成降噪（形态+极值+间隔）过滤
- ✅ **信号融合机制**：同一K线多周期只保留最强信号
- ✅ 图表横排按钮极简操作
- ✅ 一键清除信号标记、一键清仓
- ✅ 所有弹窗及声音提醒可关闭
- ✅ **完全兼容MetaTrader 5平台**

---

## ⚙️ 主要参数说明

| 参数名 | 含义 | 推荐设置 |
|--------|------|----------|
| **RSI_Period** | RSI周期 | `14` |
| **Oversold_Level** | 超卖阈值 | `30` |
| **Overbought_Level** | 超买阈值 | `70` |
| **Extreme_Oversold** | 极端超卖，仅底背离有效 | `20` |
| **Extreme_Overbought** | 极端超买，仅顶背离有效 | `80` |
| **Lookback_Bars** | 扫描回看K线数 | `30` |
| **MinDivergenceGap** | 背离两极点最小间隔 | `5` |
| **MinSignalInterval** | 同方向最小信号间隔（K线数） | `8` |
| **TF1...TF5** | 监控时间周期，最多5个 | `M15/H1/H4等` |
| **Sound_Alerts** | 是否开启弹窗/声音提醒 | `true/false` |
| **Sound_File** | 声音文件名 | `alert.wav` |
| **Use_Chinese** | 是否中文界面 | `true/false` |

---

## 💻 功能与界面说明

### 🖱️ 图表横排按钮

- **"清除"/"Clear"**：一键清除所有RSI和背离信号标记
- **"平仓"/"Close"**：一键平掉当前品种所有持仓
- **周期状态栏**：实时显示当前监控周期（可自行设置/切换）

### 📊 信号标记

- **底背离（Bullish Divergence）**：🟢 绿色↑箭头+说明
- **顶背离（Bearish Divergence）**：🟠 橙色↓箭头+说明
- **RSI反弹穿越/回落**：自动标记关键反转点

### 🔧 降噪与信号过滤

#### 传统降噪机制
- 背离仅在极端超卖/超买、且分型成立、与上次信号间隔充分时触发，极大降低重复/虚假信号
- 每个周期独立计数、独立监控

#### 🎯 信号融合机制（新增）
- **统一收集**：所有监控周期的信号统一收集到缓存中
- **智能筛选**：同一K线上的同类信号（底背离/顶背离），只保留**最高周期**的信号
- **避免重复**：彻底消除同一时间点的重复信号报警
- **提升质量**：高周期信号通常更可靠，优先级更高

> 📊 **工作原理**：每根K线完成时，系统会检查该K线是否有多个周期产生同类信号，自动保留周期最大的信号（如H4优先于H1，H1优先于M15），其余信号被丢弃，只有融合后的信号才会触发报警和图表标记。

### 🌐 多语言手动切换

- 通过参数 `Use_Chinese` 控制显示语言（`true=中文`，`false=英文`）

### 🔔 警报/声音提醒

- 通过参数 `Sound_Alerts` 控制
- 设为 `false` 时不弹窗不响铃，只日志输出

---

## 📝 典型用法建议

> 💡 **最佳实践指南**

1. **周期选择**：建议仅选择2-4个常用周期组合
2. **降噪处理**：高波动市场建议提高 `MinSignalInterval` 降低杂音
3. **交易策略**：结合主观判断，用信号作交易辅助，而非全自动买卖
4. **回测验证**：支持在模拟盘环境全功能回测

---

## 🔍 关键代码片段说明

`Sound_Alerts` 实际控制弹窗和声音：

```mql5
void Notify(...) {
    ...
    if(Sound_Alerts) {
        Alert(msg);
        PlaySound(Sound_File);
    }
    Print(msg); // 总是输出日志
}
```

---

## ⚠️ 注意事项

> ⚡ **重要提醒**

- ✅ 请确保EA运行在 `MQL5/Experts` 目录，不要用 `indicator_chart_window` 等指标声明
- ✅ 按钮如未显示，可调整分辨率或缩放
- ✅ 各周期参数可以随时修改后重新加载

---

## 🔧 MetaTrader 5 兼容性说明

### 平台要求

- **适用版本**：MetaTrader 5 (Build 2000+)
- **操作系统**：Windows 7/8/10/11，macOS，Linux
- **架构支持**：32位和64位系统均兼容

### 安装部署

#### 1. 文件位置

```
MetaTrader 5/
├── MQL5/
│   ├── Experts/
│   │   └── RSI Alert.mq5  ← EA主文件
│   ├── Include/
│   └── Libraries/
└── Sounds/
    └── alert.wav  ← 声音文件（可选）
```

#### 2. 编译要求

- **MQL5语言**：完全使用标准MQL5语法
- **编译器**：MetaEditor内置编译器
- **依赖库**：仅使用MT5标准库，无第三方依赖

#### 3. 权限设置

在MT5中启用以下权限：

- ✅ **允许算法交易**：工具 → 选项 → 专家顾问 → 允许算法交易
- ✅ **允许DLL导入**：不需要（本EA无DLL依赖）
- ✅ **允许外部专家导入**：如需要的话

### 兼容特性

#### 市场兼容性

- ✅ **外汇市场**：所有主要货币对
- ✅ **贵金属**：黄金、白银等
- ✅ **指数**：股指CFD
- ✅ **商品**：原油、天然气等
- ✅ **股票**：个股CFD
- ✅ **加密货币**：比特币等数字资产

#### 账户类型

- ✅ **标准账户**：完全支持
- ✅ **ECN账户**：完全支持
- ✅ **模拟账户**：完全支持，推荐先行测试

#### 时间框架

支持所有MT5标准时间框架：

| 时间框架 | 代码 | 支持状态 |
|----------|------|----------|
| 1分钟 | M1 | ✅ |
| 5分钟 | M5 | ✅ |
| 15分钟 | M15 | ✅ |
| 30分钟 | M30 | ✅ |
| 1小时 | H1 | ✅ |
| 4小时 | H4 | ✅ |
| 日线 | D1 | ✅ |
| 周线 | W1 | ✅ |
| 月线 | MN1 | ✅ |

### 性能优化

#### 资源占用

- **CPU使用率**：低于5%（正常市场条件下）
- **内存占用**：小于50MB
- **网络流量**：仅接收必要的价格数据

#### 优化建议

1. **同时监控周期**：建议不超过5个时间框架
2. **历史数据**：确保至少有1000根K线历史
3. **服务器连接**：保持稳定的网络连接

### 故障排除

#### 常见问题

**问题1：EA无法加载**
```
解决方案：
1. 检查文件是否在正确目录
2. 重新编译EA
3. 检查MT5版本是否支持
```

**问题2：按钮不显示**
```
解决方案：
1. 调整图表显示比例
2. 检查是否启用了专家顾问
3. 重启MT5终端
```

**问题3：信号不出现**
```
解决方案：
1. 检查参数设置是否合理
2. 确认有足够的历史数据
3. 检查市场是否开放
```

#### 技术支持

如遇到兼容性问题：

1. **日志检查**：查看MT5专家顾问日志
2. **版本确认**：确认MT5版本号
3. **参数验证**：检查所有参数设置

> 📝 **注意**：本EA完全基于MQL5标准开发，与MT5平台100%兼容，不依赖任何第三方库或插件。

---

## 🔬 技术原理与信号判据

### 7.1 RSI反转/穿越信号

#### 超卖反弹

```
RSI[1] < Oversold_Level 且 RSI[0] > Oversold_Level
```

即最新一根K线RSI刚刚上穿超卖阈值。

#### 超买回落

```
RSI[1] > Overbought_Level 且 RSI[0] < Overbought_Level
```

即最新一根K线RSI刚刚下穿超买阈值。

> 该信号常用于捕捉RSI极端状态下的短期反弹或回调，属于传统RSI系统的"警戒"类信号。

### 7.2 背离形态判据

#### 7.2.1 底背离（Bullish Divergence）

判断条件：

1. **价格形成分型底**：`Close[i] < Close[i-1] && Close[i] < Close[i+1]`（三点分型）
2. **RSI极端低位**：`RSI[i] < Extreme_Oversold && RSI[i] < Oversold_Level`
3. **与上一个信号间隔足够**：当前点与上次底背离信号的时间戳之差大于`MinSignalInterval*周期秒数`
4. **价格背离**：当前底点价格 > 前`MinDivergenceGap`根K线前的底点价格，且RSI更低

> 全部成立才会触发信号，以最大程度去除震荡区假背离

#### 7.2.2 顶背离（Bearish Divergence）

判断条件：

1. **价格形成分型顶**：`Close[i] > Close[i-1] && Close[i] > Close[i+1]`
2. **RSI极端高位**：`RSI[i] > Extreme_Overbought && RSI[i] > Overbought_Level`
3. **间隔与去噪、RSI背离要求**：同底背离

#### 📊 降噪机制总结

**传统降噪**：仅在极端超买/超卖、分型明确且距离上次信号有充分时间的K线上判定背离，有效过滤微震荡和虚假背离。

**信号融合降噪**：在传统降噪基础上，增加多周期信号融合机制：
1. **缓存收集**：所有监控周期的信号先进入统一缓存
2. **优先级排序**：按周期大小排序（月线>周线>日线>4小时>1小时>15分钟等）
3. **同类筛选**：同一K线的同类信号只保留最高周期
4. **最终输出**：只有融合后的信号才触发报警和标记

> 🎯 **效果**：彻底避免了"同一时刻多个周期同时报警"的重复干扰，大幅提升信号质量和用户体验。

---

## 🎨 UI美化与交互细节

### 8.1 图表按钮和状态栏

- **极简配色**：按钮采用 `clrLightSkyBlue`（淡蓝）/`clrIndianRed`（红），字体白色，避免高对比度刺激
- **横排布局**：居中顶栏，按钮与状态栏左右留白，避免遮挡K线主要区域
- **状态栏**：自动汇总所有已选周期，实时显示
- **支持中英双语**：所有UI元素随参数切换即时响应

### 8.2 标记风格

- **背离信号**：用绿色（底背离↑233）/橙色（顶背离↓234）箭头，贴合传统交易习惯
- **文字说明**：每个信号附带周期、RSI值说明（如"Bullish Divergence H1 RSI:19.4"），方便回测/对照
- **自动排布**：标记与K线实际收盘价略有偏移，防止遮挡K线

### 8.3 交互与可扩展

- **一键清除**：按钮响应快，可多次点击
- **一键清仓**：仅针对当前品种，调用标准MQL5 `CTrade.PositionClose`
- **无弹窗/无声音时**：仅日志输出，不干扰盘面

---

## 🛠️ 代码二次开发与定制扩展建议

### 9.1 周期与参数扩展

- 可直接添加更多周期（如周线、月线）到 `tfs` 数组，实现多周期共振监控
- 参数暴露完整，适合用于优化、回测和微调

### 9.2 信号复合/并联

- 可将 `Notify` 拓展为多策略并行（如结合MACD、CCI等共振信号）
- 亦可引入持仓过滤、趋势判断，提高信号置信度
- **信号融合机制**可作为模板，扩展到其他类型信号的去重处理

### 9.3 信号融合算法优化

- 可自定义周期优先级权重，不仅按时间周期，还可按成功率排序
- 可增加信号强度评分系统，综合RSI偏离度、价格背离幅度等因素
- 可扩展为跨策略信号融合（如RSI+MACD+布林带综合信号）

### 9.3 UI功能升级

- 状态栏可扩展为信号统计板（今日/本周信号次数、胜率等）
- 支持按钮自定义配色、样式，兼容深色/浅色主题
- 可加入快捷键响应（如`Ctrl+Q`清除信号等）

### 9.4 日志与记录

- 当前所有信号均Print到MT5日志，可很方便用于历史分析
- 可进一步扩展为写入CSV/外部文件，便于长期统计

---

## ⚖️ 策略适用性与风险提示

> ⚠️ **重要警告**

- 背离信号本质为 **"逆势超跌反弹博弈"**，不宜盲目全信号进场
- 宜结合大周期趋势、资金管理、风控配合
- 建议配合主观盘感、结构形态综合研判使用
- 实盘建议先低仓位验证，避免过度信号追单

---

## ❓ 常见问题与调试建议

### 信号密集？

可适当调大 `MinDivergenceGap` 和 `MinSignalInterval`，并提高 `Extreme_Oversold` / `Extreme_Overbought` 阈值。

### UI遮挡？

可增大按钮上方边距、或移动至其他角落。

### 按钮不显示？

检查EA是否运行在 `MQL5/Experts`，不要误用为指标。另外请确认：
- MT5版本是否为Build 2000+
- 是否启用了算法交易权限
- 图表显示比例是否合适

### 不弹窗？

检查 `Sound_Alerts`，或测试MT5声音/弹窗设置。确保：
- MT5终端声音设置已启用
- 系统音量设置正常
- `alert.wav` 文件存在于Sounds目录

---

## 📞 支持与联系

如有问题或建议，请联系开发者或查阅相关文档。

---

*最后更新：2025年8月*